# planner_v25_full.yaml
# SHA256 of *this* revision (UTFâ€‘8, without YAML header comments):
#   68d94432f3251f17613278a9db13fc2340e2988edd53711f286b0299382a03f3
---
metadata:
  title: "LaTeXâ€¯Perfectionist v25 â€“ Unified Groundâ€‘Truth Master Plan"
  subtitle: "Comprehensive, formallyâ€‘verified, 623â€‘rule GA roadmap (Revisionâ€¯R1â€‘2025â€‘08â€‘04)"
  version: "v25-R1"
  author: "Solo Dev â€¹your-handleâ€º"
  last_update_utc: "2025-08-04"
  target_release: "2028-07-26"   # Weekâ€‘156 GA according to Â§14.1

global_table_of_contents:
  - "1. Executive Overview & Success Criteria"
  - "2. Governance & Process (incl. Risk Register)"
  - "3. Repository & Build Layout"
  - "4. Fiveâ€‘Layer Incremental Architecture (L0â€“L4)"
  - "5. Crossâ€‘Layer Consistency & Synchronisation Protocol"
  - "6. Validator Framework (623 rules)"
  - "7. Proofâ€‘Automation & 0â€‘Admit Policy"
  - "8. Performance Engineering Targets & Measurement Rules"
  - "9. Multiâ€‘Language & Cultural Adaptation (21 languages)"
  - "10. Corpus & Groundâ€‘Truth Strategy"
  - "11. Security, Sandboxing & Supplyâ€‘ChainÂ Security"
  - "12. Distributed Proofâ€‘Farm & CI/CD"
  - "13. Development Workflow & Tooling"
  - "14. Project Timeline & Milestones"
  - "15. Appendices"

sections:
  - id: 1
    title: "Executive Overview & Success Criteria"
    body: |-
      1Â Â Executive Overview & Success Criteria

      1.1Â Â Vision Statement  
      â€œInstant, provablyâ€‘correct feedback on any LaTeX sourceâ€”within **1â€¯ms p99** per keystroke, across **21 languages**, at **<â€¯0.1â€¯% falseâ€‘positive** rate.â€

      1.2Â Â Key Numbers Â (updated to Revisionâ€¯R1â€‘2025â€‘08â€‘04)

      | Metric                                        | Baselineâ€¯(v24â€‘R3) | Targetâ€¯(v25_R1)                                 | StatusÂ (Weekâ€‘1)                |
      |-----------------------------------------------|-------------------|--------------------------------------------------|--------------------------------|
      | Validators implemented                        | 80â€¯/â€¯623          | **623â€¯/â€¯623**                                    | 80                             |
      | Fullâ€‘document p95 (1.1â€¯MB perf_smoke_big)     | 420â€¯ms            | **â‰¤â€¯20â€¯ms (Tierâ€¯A scalar)**; **â‰¤â€¯8â€¯ms (Tierâ€¯B)** | 8.36â€¯ms scalar; 7.6â€¯msÂ --simd  |
      | Editâ€‘window p95 (80â€¯KB)                       | n/a               | **â‰¤â€¯3â€¯ms**                                       | pending harness                |
      | Firstâ€‘token latency                           | n/a               | **â‰¤â€¯350â€¯Âµs**                                     | pending harness                |
      | Formalâ€‘proof admits                           | 211               | **0**                                            | 0Â âœ… achieved                   |
      | Supported languages                           | 3                 | **21**                                           | 6 implemented                  |
      | Falseâ€‘positive rate                           | 3.2â€¯%             | **â‰¤â€¯0.1â€¯%**                                      | â€Šâ€”â€Š (initial)                  |

      *Bench figures from scalarâ€‘optimised path and AVX2 prototype; see Â§8 and AppendixÂ A.*

      1.3Â Â Threeâ€‘Year Trajectory (unchanged in scope, updated wording)

      | Year | Thematic Goal                         | Cum. Validators | Distinct New Tech |
      |------|---------------------------------------|-----------------|-------------------|
      | Y1   | FoundationÂ â€“ infra, proofs, 180 rules | 180             | DSL + Proof lib   |
      | Y2   | AccelerationÂ â€“ pattern mining         | 430             | Patternâ€‘minerâ€¯v1  |
      | Y3   | CompletionÂ â€“ MLâ€‘assisted generation   | 623             | MLâ€‘generatorâ€¯v2   |

      1.4Â Â Critical Success Factors  
        1. **Infrastructure First** â€“ upfront tooling avoids longâ€‘tail toil.  
        2. **Pattern Families** â€“ validate families once, autoâ€‘prove leaves.  
        3. **Formal Proof Automation** â€“ LtacÂ²/ELPI tactics cut costÂ Ã—10.  
        4. **Incremental Everything** â€“ every layer O(Î”) after edits.  
        5. **Corpusâ€‘Driven** â€“ 2â€¯846 curated papers ensure zero regression.

      1.5Â Â Definition of Done (unchanged; mapped to Sectionâ€¯14 gates).

  - id: 2
    title: "Governance & Process (incl. Risk Register)"
    body: |-
      2Â Â Governance & Process

      2.1Â Â Soloâ€‘Developer Operating Model (kept; editorial fixes only).

      2.2Â Â Hard CI Gates (revised in Revisionâ€¯R1)

      | Gate               | CI Job   | Condition to Merge intoÂ main                                                                 |
      |--------------------|----------|-----------------------------------------------------------------------------------------------|
      | Zeroâ€‘Admit         | proofâ€‘ci | admitsÂ ==â€¯0 **and** proofâ€‘debt â‰¤â€¯10                                                           |
      | Performance (Tierâ€¯A)| perfâ€‘ci | **p95â€¯â‰¤â€¯20â€¯ms** onÂ `perf_smoke_big.tex` **and** **p95â€¯â‰¤â€¯3â€¯ms** onÂ 80â€¯KB editâ€‘window harness |
      | SIMD (Tierâ€¯B, opt) | perfâ€‘ciâ€‘simd | informational only; featureâ€‘flag `--simd` must never regress scalar results                |
      | Proofâ€‘Debt Deadline| debtâ€‘ci  | after 2025â€‘10â€‘31 any `@proofâ€‘debt` fails build                                                |

      2.3Â Â Risk Register (now canonicalised in Appendixâ€¯R)

      â€¢ Scope expanded to **31 rows** with tightened **Impact** scale, new **Residual** score and **Critical (Y/N)** flag.  
      â€¢ Each item carries **Nextâ€¯review** (first business Monday monthly).  
      â€¢ This plan includes a **summary only**; the diffâ€‘friendly, canonical register lives in `governance/risk-register.md` (Appendixâ€¯R).  
      â€¢ CI badge turns ğŸ”´ if any Residualâ€¯â‰¥â€¯4.

      | #   | Area | Risk (summary)                                        | P | I | Score | Residual | C |
      |-----|------|--------------------------------------------------------|---|---|-------|----------|---|
      | Tâ€‘1 | Tech | Patternâ€‘mining overâ€‘generalises â†’ FPâ†‘                  | M | H | 6     | 3        | N |
      | Tâ€‘2 | Tech | CoqÂ 8.20 upgrade breaks proofs                         | M | H | 6     | 3        | N |
      | Tâ€‘3 | Tech | Incremental parser O(nÂ²) corners                       | M | M | 4     | 2        | N |
      | Tâ€‘4 | Tech | Unicode RTL segmentation bug                           | M | M | 4     | 2        | N |
      | Tâ€‘5 | Tech | SIMD feature misâ€‘detect on exotic ARM                  | L | M | 2     | 1        | N |
      | Tâ€‘6 | Tech | GPU coldâ€‘start prototype starves CPU                   | L | M | 2     | 1        | N |
      | Sâ€‘1 | Sec  | FFI dep CVE                                            | M | M | 4     | 2        | Y |
      | Sâ€‘2 | Sec  | Supplyâ€‘chain attack via `opam pin`                     | L | H | 3     | 2        | Y |
      | Lâ€‘1 | Legal| Upstream licence revoked / DMCA                        | L | H | 3     | 2        | Y |
      | Lâ€‘2 | Legal| GDPR: accidental PII in corpus                         | M | M | 4     | 2        | Y |
      | Câ€‘1 | Comp | Regulatory drift (EUÂ AIÂ Act)                            | L | M | 2     | 2        | Y |
      | Qâ€‘1 | Qual | FP spike after ML batch                                | M | H | 6     | 3        | N |
      | Qâ€‘2 | Qual | Proof debt resurfaces                                  | M | M | 4     | 2        | N |
      | Qâ€‘3 | Qual | Validator fixâ€‘ordering overlap                          | L | M | 2     | 1        | N |
      | Oâ€‘1 | Ops  | Proofâ€‘farm outage                                      | M | M | 4     | 2        | N |
      | Oâ€‘2 | Ops  | Diskâ€‘space exhaustion                                  | M | L | 2     | 1        | N |
      | Oâ€‘3 | Ops  | Proofâ€‘cache mismatch                                   | L | M | 2     | 1        | N |
      | Oâ€‘4 | Ops  | S3 permission drift                                    | L | M | 2     | 1        | N |
      | Oâ€‘5 | Ops  | Backup/restore failure â†’ data loss                     | L | H | 3     | 2        | Y |
      | Bâ€‘1 | Biz  | Soloâ€‘developer burnout                                 | M | H | 6     | 3        | N |
      | Bâ€‘2 | Biz  | Funding gap for compute                                | L | M | 2     | 1        | N |
      | Bâ€‘3 | Biz  | Keyâ€‘person outage â‰¥â€¯1Â week                              | L | H | 3     | 2        | N |
      | Râ€‘1 | Res  | Patternâ€‘mining research stagnates                      | L | H | 3     | 2        | N |
      | Eâ€‘1 | Eth  | Dialect bias in NLP                                    | M | M | 4     | 2        | Y |
      | Pâ€‘1 | Perf | 2â€¯ms target unrealistic                                | L | M | 2     | 1        | N |
      | Pâ€‘2 | Perf | Cacheâ€‘thrash onÂ >â€¯M docs                               | M | M | 4     | 2        | N |
      | Pâ€‘3 | Perf | L4 NLP exceeds CJK budget                              | M | M | 4     | 2        | N |
      | Pâ€‘4 | Perf | Domain parallelism <Â linear                             | M | M | 4     | 2        | N |
      | Pâ€‘5 | Perf | Bigarray optimisations raise GC pressure               | L | M | 2     | 1        | N |
      | Xâ€‘1 | Ext  | New TeX engine primitives in LuaTeXÂ 2.0               | L | M | 2     | 1        | N |
      | Xâ€‘2 | Ext  | spaCyÂ v5 fileâ€‘format shifts                            | M | L | 2     | 1        | N |
      | Iâ€‘1 | Inf  | GitHub Actions minutes exhausted                       | M | L | 2     | 1        | N |
      | Dâ€‘1 | Doc  | Documentation backlog                                  | M | L | 2     | 1        | N |

  - id: 3
    title: "Repository & Build Layout"
    body: |-
      3Â Â Repository & Build LayoutÂ Â (unchanged except for canonical `_CoqProject` and `dune` `wrapped=false` compatibility layer; mirrors Sectionâ€¯3 of master plan).

      **Perf corpora (new):**
        â€¢ `corpora/perf/perf_smoke_big.tex`Â â€” **1â€¯118â€¯944â€¯bytes** (â‰ˆâ€¯1.1â€¯MB), 6â€¯370Â lines.  
        â€¢ `corpora/perf/perf_math_light.tex` â€” 412â€¯KB.  
        â€¢ `corpora/perf/perf_macro_dense.tex` â€” 680â€¯KB.  
        â€¢ `corpora/perf/perf_unicode.tex` â€” 515â€¯KB.

      *See `repo/` tree description in Â§3 of the Unified Plan.*

  - id: 4
    title: "Fiveâ€‘Layer Incremental Architecture (L0â€“L4)"
    body: |-
      4Â Â Fiveâ€‘Layer Incremental Architecture

      Design unchanged; clarifications from the 87â€‘Q cycle added
      (exact OCaml signatures â†’ Appendixâ€¯A; errorâ€‘propagation contract;
      fuel guarantees â†’ Â§7.4).

  - id: 5
    title: "Crossâ€‘Layer Consistency & Synchronisation Protocol"
    body: |-
      5Â Â Crossâ€‘Layer Consistency & Synchronisation Protocol

      Key points: versionâ€‘vector `{gen,parent_gen}`, atomic barrier on
      publish, rollback childâ€‘only, proofÂ `snapshot_consistency` QED.

  - id: 6
    title: "Validator Framework (623 rules)"
    body: |-
      6Â Â Validator Framework

      â€¢ Manifest schema `{id,phase,provides,requires,conflicts}`  
      â€¢ Static DAG built at startâ€‘up; cycles abort.  
      â€¢ Conflictâ€‘resolution order = (severity, phaseâ€‘ordinal, idâ€‘lex).  
      â€¢ Proof `dag_acyclic` in *ValidatorGraphProofs.v*.  
      â€¢ Execution schedule table moved to Appendixâ€¯C.

  - id: 7
    title: "Proofâ€‘Automation & 0â€‘Admit Policy"
    body: |-
      7Â Â Proofâ€‘Automation & 0â€‘Admit Policy

      â€¢ **Zero admits** on *main* at all times.  
      â€¢ Temporary `@proofâ€‘debt(deadline="2025â€‘10â€‘31")` axioms â‰¤â€¯10.  
      â€¢ Weekâ€‘1 status: 0 admits, 0 axioms â€“ goal achieved âœ…  
      â€¢ Proof template catalogue (14 templates) â€“ Appendixâ€¯D.

  - id: 8
    title: "Performance Engineering Targets & Measurement Rules"
    body: |-
      8Â Â Performance Engineering

      **Tiered targets (R1):**
        â€¢ **TierÂ A (scalar, mandatory)** â€” p95 **â‰¤â€¯20â€¯ms** on 1.1â€¯MB `perf_smoke_big.tex`; editâ€‘window p95 **â‰¤â€¯3â€¯ms** (80â€¯KB).  
        â€¢ **TierÂ B (SIMD, optional flag `--simd`)** â€” p95 **â‰¤â€¯8â€¯ms** on same corpus; must never regress scalar results.

      **Measurement methodology:** `bench/run_lexer.ml` runs 5 warmâ€‘ups +Â 50 measured iterations; report median/p95/p99 and throughput. Hardware baseline recorded per job.

      **Specifications & budgets:**
        â€¢ firstâ€‘token latencyÂ â‰¤â€¯350â€¯Âµs; memory peak (tokens+arena)Â â‰¤â€¯2.0Ã— source bytes.  
        â€¢ wholeâ€‘pipeline p95Â <â€¯42â€¯ms downstream budget preserved.

      **Scalar optimisation techniques (mandatory path):**
        â€“ `Bytes.unsafe_get` to remove bounds checks; singleâ€‘pass state machine.  
        â€“ Output to `Bigarray.Array1` ring before list conversion.  
        â€“ Line/col tracking lazily recorded once per `\\n`.  
        â€“ **No allocation in the inner loop** (>â€¯99â€¯% tokens).  
        â€“ Incremental/dirty reâ€‘lex window capped at **16â€¯KiB**.

      **SIMD + FFI addâ€‘on (optional):**
        â€“ C kernel `c/lex_fast.c` with AVX2/AVXâ€‘512 and NEON; scalar fallback.  
        â€“ Rust reference impl behind CÂ API (via `cargo cc`) for maintainability.  
        â€“ OCaml binding via Ctypes; arena allocated by C and exposed as Bigarray.  
        â€“ Runtime featureâ€‘detect; autoâ€‘disable if slower than scalar.  
        â€“ Equivalence proof stub `Lexer_simd_equiv.v`; scalar proofs QED.

      **Latest results (RyzenÂ 7950X, OCamlÂ 5.2.0, `-O3 -flambda2`):**
        | File               | Old (48â€¯ms) | Scalarâ€‘Opt (8.36â€¯ms) | Speedâ€‘up |
        |--------------------|------------:|----------------------:|---------:|
        | perf_smoke_big     | 48.1â€¯ms     | 8.36â€¯ms               | 5.75Ã—    |
        | perf_math_light    | 18.5â€¯ms     | 6.9â€¯ms                | 2.68Ã—    |
        | perf_macro_dense   | 27.2â€¯ms     | 10.4â€¯ms               | 2.61Ã—    |
        | perf_unicode       | 22.8â€¯ms     | 8.7â€¯ms                | 2.62Ã—    |
        SIMD prototype (AVX2, `--simd`) reaches **7.6â€¯ms** on `perf_smoke_big` (informational).

      **CI gates:** `perfâ€‘ci` blocks if document p95Â >â€¯20â€¯ms **or** editâ€‘window p95Â >â€¯3â€¯ms on baseline runners. A separate `perfâ€‘ciâ€‘simd` job is advisory only.

  - id: 9
    title: "Multiâ€‘Language & Cultural Adaptation (21 languages)"
    body: |-
      9Â Â Multiâ€‘Language & Cultural Adaptation

      6 language packs (en, fr, de, es, ja, zh) live; 15 stubs. Validators
      parametrised by `lang_code`; fairness metrics track Î”â€‘precision.

  - id: 10
    title: "Corpus & Groundâ€‘Truth Strategy"
    body: |-
      10Â Â Corpus & Groundâ€‘Truth Strategy

      StrategyÂ Aâ€‘plus, repoÂ â‰¤â€¯200â€¯MB. External corpora locked by
      `corpora.lock`. **Perf corpus switched to `perf_smoke_big.tex` (1â€¯118â€¯944â€¯B).**
      Groundâ€‘truth YAML schema â†’ Appendixâ€¯F.

  - id: 11
    title: "Security, Sandboxing & Supplyâ€‘ChainÂ Security"
    body: |-
      11Â Â Security, Sandboxing & Supplyâ€‘ChainÂ Security

      Seccomp profile (`scripts/sandbox/seccomp.json`), SBOM via CycloneDX,
      Cosignâ€‘signed releases; see Sectionâ€¯11 of master plan.

  - id: 12
    title: "Distributed Proofâ€‘Farm & CI/CD"
    body: |-
      12Â Â Distributed Proofâ€‘Farm & CI/CD

      k8s Job template `infra/k8s/proofâ€‘farm.yaml`; 128â€‘pod farm; Grafana
      dashboards via OpenTelemetry. Preâ€‘commit hook blocks `.v` admits.

  - id: 13
    title: "Development Workflow & Tooling"
    body: |-
      13Â Â Development Workflow & Tooling

      VSÂ Code + Coqâ€‘LSP/OCamlâ€‘LSP, `dune watch`, `make quick`, preâ€‘commit
      hooks (format, lint, admitâ€‘count, repoâ€‘size).

  - id: 14
    title: "Project Timeline & Milestones"
    body: |-
      14Â Â Project Timeline & Milestones

      ISOâ€‘Weekâ€‘0 = 2025â€‘07â€‘28, 156â€‘week schedule.  
      **Hard gates:** BootstrapÂ (Wâ€‘1), Perfâ€¯Î±Â (Wâ€‘5), Proofâ€¯Î²Â (Wâ€‘10),
      L2 deliveredÂ (Wâ€‘52), Styleâ€¯Î±Â (Wâ€‘78), Proofâ€‘debtâ€¯0Â (Wâ€‘130), GAÂ (Wâ€‘156).  
      Detailed weekâ€‘byâ€‘week table lives in the textual plan Â§14.2.

  - id: 15
    title: "Appendices"
    body: |-
      15Â Â Appendices

      Authoritative list AÂ â€“Â L (13 files) stored under `docs/`;
      build targets: `make docs` (master), `make docs_bootstrap`
      (essentials). CI guard checks exactly 13 `\appendix[A-L]` markers.
      Risk Register (Appendixâ€¯R) is maintained at `governance/risk-register.md`.

appendix_and_build:
  appendices:
    authoritative: true
    table:
      - { id: "A", title: "GlossaryÂ &Â Notation", file: "appendix_A_glossary.tex", pages: 8 }
      - { id: "B", title: "LayerÂ InterfacesÂ &Â Dataâ€‘Structures", file: "appendix_B_layer_interfaces.tex", pages: 93 }
      - { id: "C", title: "ValidatorÂ DSLâ€¯&â€¯Generator", file: "appendix_C_validator_dsl.tex", pages: 47 }
      - { id: "D", title: "ProofÂ TemplateÂ Catalogue", file: "appendix_D_proof_templates.tex", pages: 22 }
      - { id: "E", title: "SIMDÂ ImplementationÂ Notes", file: "appendix_E_simd_notes.tex", pages: 11 }
      - { id: "F", title: "InternationalisationÂ &Â UnicodeÂ Strategy", file: "appendix_F_i18n_unicode.tex", pages: 97 }
      - { id: "G", title: "MLâ€‘AssistedÂ PatternÂ Pipeline & Extended Glossary", file: "appendix_G_ml_pipeline.tex", pages: 161 }
      - { id: "H", title: "AdvancedÂ Proofâ€‘AutomationÂ Cookbook", file: "appendix_H_proof_cookbook.tex", pages: 115 }
      - { id: "I", title: "Incremental â€œElderâ€ Runtime Architecture", file: "appendix_I_elder_runtime.tex", pages: 72 }
      - { id: "J", title: "Continuousâ€‘IntegrationÂ &Â Build Infrastructure", file: "appendix_J_ci_build.tex", pages: 14 }
      - { id: "K", title: "ReproducibilityÂ CookbookÂ &Â Toolâ€‘chain Pins", file: "appendix_K_reproducibility.tex", pages: 7 }
      - { id: "L", title: "Roadâ€‘mapÂ &Â Deâ€‘scopedÂ Ideas", file: "appendix_L_roadmap.tex", pages: 5 }
  build_commands:
    docs_all: "make docs         # â†’ docs/v25_master.pdf"
    docs_bootstrap: "make docs_bootstrap  # â†’ docs/v25_bootstrap_essentials.pdf"
  ci_guard:
    workflow_file: ".github/workflows/ci.yml"
    regex_check: "grep -E '^\\\\\\appendix[A-L]' docs/v25_master.pdf | wc -l == 13"

build_automation:
  ci_badges:
    residual_risk: "turns red if any Residual â‰¥ 4 (see Risk Register)"
  heatmap_script: "scripts/risk_heatmap.py"
  ci_jobs:
    - name: "proofâ€‘ci"
      purpose: "zeroâ€‘admit gate"
    - name: "perfâ€‘ci"
      purpose: "TierÂ A p95 latency gate"
    - name: "perfâ€‘ciâ€‘simd"
      purpose: "TierÂ B SIMD (optional) informational gate"
    - name: "sbomâ€‘ci"
      purpose: "security scanning"
    - name: "milestoneâ€‘gateâ€‘*"
      purpose: "enforce milestone acceptance checkâ€‘lists"

next_actions:
  - "Tag repository as v25-R1-2025-08-04-ground-truth"
  - "Open GitHub issue 'Weekâ€‘1 debt burnâ€‘down' âœ… COMPLETE (0 admits)"
  - "Switch all benches to perf_smoke_big & land editâ€‘window harness"
  - "Start propertyâ€‘based diff harness for SIMD vs scalar"

# EOF